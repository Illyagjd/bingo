<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>订单列表</title>
    <link rel="stylesheet" type="text/css" href="/css/orderList.css">
    <script type="text/javascript" src="extlib/jquery-3.5.1/jquery-3.5.1.min.js"></script>
</head>
<body>
<div class="community-content">
    <div class="tabs-container">
        <div class="order-main" id="content">
            <div class="order-title">
                <div class="row1">商品名称</div>
                <div class="row2">购买日期</div>
                <div class="row3">订单号</div>
                <div class="row3">总计</div>
            </div>
            <!--<div class="myorder-elem">
                    <span class="column1">
                        <span class="column1-elem" id="1-1" onmouseover="on(this)" onmouseout="leave(this)">
                            <img src="/src/cover1.jpg">
                            <span class="column1-elem-txt" id="txt1-1">只狼</span>
                        </span>
                        <span class="column1-elem" id="1-2" onmouseover="on(this)" onmouseout="leave(this)">
                            <img src="/src/cover1.jpg">
                            <span class="column1-elem-txt" id="txt1-2">天外飞仙</span>
                        </span>
                        <span class="column1-elem" id="1-3" onmouseover="on(this)" onmouseout="leave(this)">
                            <img src="/src/cover1.jpg" >
                            <span class="column1-elem-txt" id="txt1-3">落花</span>
                        </span>
                        <span class="column1-elem" id="1-4" onmouseover="on(this)" onmouseout="leave(this)">
                            <img src="/src/cover1.jpg">
                            <span class="column1-elem-txt" id="txt1-4">流雪</span>
                        </span>
                        <span class="column1-elem" id="1-5" onmouseover="on(this)" onmouseout="leave(this)">
                            <img src="/src/cover1.jpg">
                            <span class="column1-elem-txt" id="txt1-5">柳絮</span>
                        </span>
                    </span>
                <div class="row2">2020-08-02</div>
                <div class="row3">201701****</div>
                <div class="row3">￥80.00</div>
                <div class="condition" id="showCode">
                    <button class="condition">查看激活码</button>
                </div>
            </div>-->
            <!--<div class="myorder-elem">
        <span class="column1">
            <span class="column1-elem">
                <img src="/src/cover1.jpg">
                <span class="column1-elem-txt">飞飞飞</span>
            </span>
            <span class="column1-elem">
                <img src="/src/cover1.jpg">
                <span class="column1-elem-txt">飞飞飞</span>
            </span>
        </span>
                <div class="row2">2020-08-02</div>
                <div class="row3">201701****</div>
                <div class="row3">￥80.00</div>
            </div>-->
        </div>
    </div>
</div>
<script type="text/javascript">
    var aCode = [];//保存激活码的数组
    //显示游戏名称
    function on(typp){
        $("#txt"+$(typp).attr("id")).show();
    }
    function leave(typp){
        $("#txt"+$(typp).attr("id")).hide();
    }
    //显示激活码
    function showCode(gameid){
        console.log("要显示激活码了")
        window.alert(aCode[gameid.id]);
    }
    $(document).ready(function (){
        function setinfo(){
            var data = {
                idType : "uid" ,
                idValue : 1
            }
            $.get(
                "store/orderListShow" , data ,//查询用户订单
                function (result){
                    var order = result.resultMap.orderList_uid;//订单数组
                    //console.log(order);
                    var i = 0,j = order.length;
                    for(; i<j; i++){
                        var activeCode = "";//临时保存激活码数组
                        var Details = JSON.parse(order[i].orderDetails);//订单详情
                        console.log(Details);

                        //订单html代码头部
                        var html = "<div class=\"myorder-elem\">\n" +
                            "                    <span class=\"column1\">";
                        var glist = Details.length ,item=0;
                        for( ; item<glist ;item++){
                            $.ajax({
                                url : "store/gameDetailShow" + "?id="+ Details[item].gid,
                                type : 'get',
                                async : false,
                                success : function (gameResult){
                                    var gameitem = gameResult.resultMap.game;
                                    //加载游戏封面和名称
                                    html+="                        <span class=\"column1-elem\" id=" + i + "-" + item+ " onmouseover=\"on(this)\" onmouseout=\"leave(this)\">\n" +
                                        "                            <img src=" + gameitem.chref + ">\n" +
                                        "                            <span class=\"column1-elem-txt\" id=" + "txt" + i + "-" + item+ ">" + gameitem.gname + "</span>\n" +
                                        "                        </span>";
                                //为激活码记录游戏名称
                                    activeCode += gameitem.gname + "的激活码:  " + Details[item].klist ;
                                }
                            })
                            activeCode +="\n";//每个游戏换行一次
                        }
                        //订单html代码尾部
                        html+= " </span>\n" +
                            "                <div class=\"row2\">" +order[i].otime.substr(0,10)+"</div>\n" +
                            "                <div class=\"row3\">" +order[i].oid+"</div>\n" +
                            "                <div class=\"row3\">"
                        //计算总价格
                        console.log("数据库date:" +order[i].otime)
                        var sumPrice = 0;
                        var datatemp = {
                            idType : "oid",
                            idValue : order[i].oid
                        }
                        $.ajax({
                            url : "store/orderListById",
                            data : datatemp,
                            type : 'get',
                            async : false,
                            success :function (priceResult){
                                sumPrice = priceResult.resultMap.orderListAllPrice;
                            }
                        })
                        //填写价格
                        html+= "￥" +sumPrice;
                        html+="</div>\n" +
                            "                <div class=\"condition\" id=\"showCode\">\n" +
                            "                    <button class=\"condition\"  id=" + i + " onclick=\"showCode(this)\">查看激活码</button>\n" +
                            "                </div>\n" +
                            "            </div>";
                        $("#content").append(html);
                        console.log(activeCode);
                        aCode.push(activeCode);
                    }
                }
            )

        }
        setinfo()
    })
</script>
</body>
</html>