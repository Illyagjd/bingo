var templateDiv=$("#choose1");var thisUser;var uid=userInfo.uid;var haveError=false;$(document).ready(function(){function d(){$.ajax({url:"/person/getUserById?uid=".concat(uid),type:"get",async:false,success:function(i){thisUser=i.resultMap.user}})}function c(){console.log(thisUser);$("#user-photo").attr("src",thisUser.uavatar);$(".user-describe").text(thisUser.uprofile);$("#user-true-name").text(thisUser.uname);$("#user-name").val(thisUser.ualias);$("#user-email").text(thisUser.umail);if(thisUser.usex==="男"){$("#select-sex").find("option[value='0']").attr("selected",true)}else{if(thisUser.usex==="女"){$("#select-sex").find("option[value='1']").attr("selected",true)}else{$("#select-sex").find("option[value='2']").attr("selected",true)}}var i=thisUser.ubirthday;var j=i;console.log(j);var m=new Array();m.push(j.substring(0,4));m.push(j.substring(5,7));m.push(j.substring(8,j.length));$("#select-year").find("option[value="+m[0]+"]").attr("selected",true);$("#select-month").find("option[value="+m[1]+"]").attr("selected",true);$("#select-date").find("option[value="+m[2]+"]").attr("selected",true)}function k(i,j){if(parseInt(i)%4==0){if(parseInt(j)==1||parseInt(j)==3||parseInt(j)==5||parseInt(j)==7||parseInt(j)==8||parseInt(j)==10||parseInt(j)==12){b=31}else{if(parseInt(j)==2){b=29}else{b=30}}}else{if(parseInt(j)==1||parseInt(j)==3||parseInt(j)==5||parseInt(j)==7||parseInt(j)==8||parseInt(j)==10||parseInt(j)==12){b=31}else{if(parseInt(j)==2){b=28}else{b=30}}}return b}$(document).click(function(){var i=$("#user-name").val().length;if(i>10){$(".form-error-msg").show();$(".form-right-msg").hide();$(".form-error-msg").text("不要超过10个字符");haveError=true}else{if(i==0){$(".form-error-msg").show();$(".form-right-msg").hide();$(".form-error-msg").text("昵称不能为空");haveError=true}else{$(".form-error-msg").hide();$(".form-right-msg").show();$(".form-right-msg").text("昵称符合要求");haveError=false}}});$("#select-month").click(function(){var o=document.getElementById("select-year");var p=document.getElementById("select-month");var m=k(o.value,p.value);console.log(m+" "+o+" "+p);$("#select-date").empty();var j="";for(var n=1;n<=m;n++){j+="<option value="+n+">"+n+"</option>";e++}$("#select-date").html(j)});$("#choose1").removeClass("close");$("#choose1").addClass("active");$(".form-error-msg").hide();$(".form-right-msg").hide();var b=new Date();var l=b.getFullYear();var e=0;var h="";var a="";var g="";for(var f=1900;f<=l;f++){h+="<option value="+f+">"+f+"</option>";e++}e=0;for(var f=1;f<13;f++){if(f<10){a+="<option value=0"+f+">"+f+"</option>"}else{a+="<option value="+f+">"+f+"</option>"}e++}e=0;for(var f=1;f<=31;f++){g+="<option value="+f+">"+f+"</option>";e++}$("#select-year").html(h);$("#select-month").html(a);$("#select-date").html(g);d();c()});$(".close").click(function(){templateDiv.removeClass("active");templateDiv.addClass("close");$(this).removeClass("close");$(this).addClass("active");templateDiv=$(this)});$(".submit").click(function(){let submitData=new FormData();let url;let files=$("#image").get(0).files[0];submitData.append("uname",thisUser.uname);submitData.append("umail",thisUser.umail);submitData.append("uprofile",$(".user-describe").val());submitData.append("ualias",$("#user-name").val());if(files==null){url="/person/updateUserNoPhoto"}else{url="/person/updateUser";submitData.append("avatar",files)}submitData.append("uid",thisUser.uid);let year=$("#select-year option:selected").val();let month=$("#select-month option:selected").val();let date=$("#select-date option:selected").val();console.log(year);console.log(month);console.log(date);let birthday=year+"-"+month+"-"+date;submitData.append("ubirthday",birthday);console.log(birthday);let sex="";if($("#select-sex option:selected").val()==="0"){sex="男"}else{if($("#select-sex option:selected").val()==="1"){sex="女"}else{sex="保密"}}console.log(sex);submitData.append("usex",sex);submitData.append("password",thisUser.password);submitData.append("gamelist",thisUser.gamelist);submitData.append("wishlist",thisUser.wishlist);JSON.stringify(submitData);if(!haveError){$.ajax({url:url,type:"post",data:submitData,processData:false,contentType:false,cache:false,async:false,success:function(a){console.dir(a);alert("修改成功")}})}else{alert("请填写符合要求的昵称")}});function change_photo(){var a=new FileReader();var b=document.getElementById("image").files[0];a.readAsDataURL(b);a.onloadend=function(c){var d=c.target.result;$("#user-photo").attr("src",d)}};