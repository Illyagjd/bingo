let game,systemReqlet systemResultlet GAMEIDlet GAMEINFOlet videohreffunction change(a){console.log("点击元素:"+$(a).attr("id"));if($(a).attr("id")==="video"||$(a).attr("id")==="videochild"){document.getElementById("show").innerHTML='<video class="videoPlayer" src='+game.vhref+' id="videoPlayer" controls="controls"  autobuffer muted >\n</video>'}else{document.getElementById("show").innerHTML="<img src="+$(a).attr("src")+" class='default-height' />"}}function star(e,a){var d=9,b,c=5;for(b=e;b>=2;b-=2){a='<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star-fill star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path  d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>\n</svg>'+a;c-=1}for(c;c>0;c--){a=a+'<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>\n</svg>'}return a}function addCar(){if(userInfo.uid===undefined){myAlert("请登录后进行操作!");return}var e={gid:parseInt(GAMEID),discount:game.discount,price:game.gprice,gname:game.gname,chref:game.chref};var a=[],c=0;if(localStorage.getItem("shoppingcar")==null||(JSON.parse(localStorage.getItem("shoppingcar")))[0]==null){}else{c=1;console.log("购物车存在");a=JSON.parse(localStorage.getItem("shoppingcar"));var b=0,d=a.length;for(;b<d;b++){if(JSON.parse(a[b]==null)){delete a[b]}else{if(GAMEID==a[b].gid){c=2;console.log("购物车存在，商品在购物车中");window.alert("已加入购物车，请勿重复添加！");break}}}}if(c==0||c==1){a.push(e);localStorage.setItem("shoppingcar",JSON.stringify(a));window.alert("加入购物车成功！")}}function buy(){if(userInfo.uid===undefined){myAlert("请登录后进行操作!");return}var k,m=1,o;k=window.prompt("输入购买数量");if(k===null){return}if(isNaN(o=parseInt(k,10))){window.alert("请输入整数!!!")}else{console.log("购买数量为: "+o);var j=0,c=[];var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz012345678";for(;j<o;j++){var p="";var f=Math.random()*57;var d=Math.random()*57;var b=Math.random()*57;var a=Math.random()*57;var q=Math.random()*57;p+=n.charAt(f)+n.charAt(d)+n.charAt(b)+n.charAt(a)+n.charAt(q);c.push(p);console.log("生成的key为: "+p)}let oid="";f=Math.random()*57;d=Math.random()*57;b=Math.random()*57;a=Math.random()*57;q=Math.random()*57;let temp6=Math.random()*57;let temp7=Math.random()*57;let temp8=Math.random()*57;let temp9=Math.random()*57;let temp10=Math.random()*57;oid+=n.charAt(f)+n.charAt(d)+n.charAt(b)+n.charAt(a)+n.charAt(q)+n.charAt(temp6)+n.charAt(temp7)+n.charAt(temp8)+n.charAt(temp9)+n.charAt(temp10);console.log("生成的oid为: "+oid);var l=new Date();var g={oid:oid,uid:userInfo.uid,gid:GAMEID,knum:k,klist:JSON.stringify(c),discount:game.discount,otime:l};console.log(g);$.post("store/insertOrderDetail",g,function(i){console.log(i)});var e=[];e.push(parseInt(GAMEID));var h={uid:userInfo.uid,gid:JSON.stringify(e),mode:1};console.log(JSON.stringify(e));$.post("/person/updateGameListById",h,function(i){console.log(i)});window.alert("购买成功！")}}function addWishList(){if(userInfo.uid===undefined){myAlert("请登录后进行操作!");return}var a={uid:userInfo.uid};$.get("/person/getUserById",a,function(b){console.log(b);wishlist=b.resultMap.wishList;console.log(wishlist);var c=0,d=0;if(wishlist==null){}else{var e=wishlist.length;for(;c<e;c++){console.log(wishlist[c].gid);console.log(GAMEID);if(GAMEID==wishlist[c].gid){d=1;break}}}if(d==1){window.alert("已在心愿单中！请勿重复添加")}else{var f={uid:userInfo.uid,gid:GAMEID,mode:1};$.post("/person/updateWishListById",f,function(g){console.log(g)});window.alert("加入心愿单成功！")}})}$(document).ready(function(){var e=location.href;var d=e.length;var c=e.indexOf("=");GAMEID=decodeURI(e.substr(c+1,d-c));$("nav.navbar ul.navbar-nav:eq(0) > li:eq(1)").addClass("active");function b(){var g={id:GAMEID};$.get("store/gameDetailShow",g,function(h){game=h.resultMap.game;console.log(h);document.getElementById("title").innerText=game.gname;document.getElementById("detail").innerText=game.detail;document.getElementById("cover").src=game.chref;videohref=game.vhref;console.log(videohref);document.getElementById("show").innerHTML='<video class="videoPlayer" src="'+game.vhref+'" id="videoPlayer"  controls="controls"  autobuffer muted >\n</video>';var j=document.createElement("canvas");video=document.getElementById("videoPlayer");j.width=145;j.height=82;j.getContext("2d").drawImage(video,0,0,j.width,j.height);console.log();document.getElementById("video").src=j.toDataURL("image/png");console.log("图片源: "+j.toDataURL("image/png"));document.getElementById("elem1").src=game.phref;document.getElementById("elem2").src=game.phref;document.getElementById("elem3").src=game.phref;document.getElementById("elem4").src=game.phref;document.getElementById("elem5").src=game.phref;document.getElementById("elem6").src=game.phref;document.getElementById("developer").innerText=game.developer;document.getElementById("publisher").innerText=game.publisher;document.getElementById("realeasedate").innerText=game.realeasedate.substr(0,10);var i=JSON.parse(game.platform);document.getElementById("platform").innerText=i;i=JSON.parse(game.language);document.getElementById("language").innerText=i;i=JSON.parse(game.gtype);document.getElementById("gtype").innerText=i;var n=game.realeasedate;console.log("发行时间:"+n);console.log(typeof game.realeasedate);if(new Date(game.realeasedate).getTime()>new Date().getTime()){$("#discount").text("发售日期："+game.realeasedate);$("#gprice").hide();$("#realPrice").hide();$(".box-buy").hide()}else{console.log("discount",game.discount);if(game.discount!==1){document.getElementById("discount").innerText="-"+((1-game.discount)*100).toFixed()+"%";document.getElementById("gprice").innerText="￥"+game.gprice}else{$(".off-discount").hide();$("#gprice").hide();$(".shoopingcat").css("margin-top","32px")}document.getElementById("realPrice").innerText="￥"+game.discount*game.gprice}systemReq=JSON.parse(game.systemreq);if(game.gscore===null||game.gscore===""){$("#gscore").text("0")}else{$("#gscore").text(game.gscore)}var o=parseInt(game.gscore);var k="";k=star(o,k);$("#gstar").html(k);function m(){if(systemReq===""||systemReq===null){return}var p={id:systemReq[0]};$.get("store/systemReqShow",p,function(q){systemResult=q.resultMap.systemReq;document.getElementById("cpu1").innerText=systemResult.cpu;document.getElementById("gpu1").innerText=systemResult.gpu;document.getElementById("os1").innerText=systemResult.os;document.getElementById("ram1").innerText=systemResult.ram;document.getElementById("harddisk1").innerText=systemResult.harddisk})}function l(){if(systemReq===""||systemReq===null){return}var p={id:systemReq[1]};$.get("store/systemReqShow",p,function(q){systemResult=q.resultMap.systemReq;document.getElementById("cpu2").innerText=systemResult.cpu;document.getElementById("gpu2").innerText=systemResult.gpu;document.getElementById("os2").innerText=systemResult.os;document.getElementById("ram2").innerText=systemResult.ram;document.getElementById("harddisk2").innerText=systemResult.harddisk})}m();l()})}function f(){var g={idType:"gid",idValue:GAMEID};$.get("store/evaluationShow",g,function(o){if(o.resultMap.evaluationList_gid==="查询评测为空"){return}console.log("evaList",o.resultMap.evaluationList_gid);var p=o.resultMap.evaluationList_gid;var k=0,n=0;var j="",m="",l="",h="";$.each(p,function(i,q){$.get("/person/getUserById?uid="+q.uid,function(s){var r=s.resultMap.user;m='<div class="sElem"><div class="score-1-3-1">\n                            <div class="Avatar">\n                                <img class="uAvatar" src='+r.uavatar+'>\n                            </div>\n                            <div class="uname">'+r.ualias+"</div>\n                        </div>";m+='<div class="score-1-3-2">\n                            <div class="score1">\n';l=star(q.score,"");h='\n                            </div>\n                            <div class="score2">发布于<span>'+q.etime.substr(0,19)+'</span></div>\n                            <div class="score3">'+q.content+"</div>\n                        </div></div>";j=m+l+h;var t="#scoreElem"+(i+1);$("#scoreElem").append(j)})})})}function a(){console.log("evaluation userInfo",userInfo);if(userInfo.uid===undefined){return}var g={uid:userInfo.uid};$.get("/person/getUserById",g,function(r){var n=location.href;var p=n.length;var o=n.indexOf("=");var m=decodeURI(n.substr(o+1,p-o));console.log("游戏ID: "+m);gamelist=JSON.parse(r.resultMap.user.gamelist);console.log(gamelist);var l=0,h=gamelist.length,q=0;for(;l<h;l++){console.log("查找到的游戏ID: "+gamelist[l]);if(m==gamelist[l]){q=1;console.log("用户拥有此游戏");break}}if(q==1){var k={gid:m,uid:userInfo.uid};$.get("store/searchEvaluationByUidAndGid",k,function(i){console.log("evaluation result",i);if(i.status==0){console.log("用户暂未评论");$("#addContent").show()}})}})}$("#submit").click(function(){var l=location.href;var j=l.length;var i=l.indexOf("=");var g=decodeURI(l.substr(i+1,j-i));var h=new Date();if($("#content-txt").val()!=""&&$("#content-score").val()!=""){var k={uid:userInfo.uid,gid:g,content:$("#content-txt").val(),score:$("#content-score").val(),etime:h.toLocaleDateString()};$.get("store/evaluationAddHandle",k,function(m){console.log(m)});window.location.reload()}});b();f();a()});