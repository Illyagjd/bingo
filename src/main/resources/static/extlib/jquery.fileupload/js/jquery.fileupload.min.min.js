(function(b){if(typeof define==="function"&&define.amd){define(["jquery","jquery-ui/ui/widget"],b)}else{if(typeof exports==="object"){b(require("jquery"),require("./vendor/jquery.ui.widget"))}else{b(window.jQuery)}}})(function(c){c.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||c('<input type="file"/>').prop("disabled"));c.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);c.support.xhrFormDataFileUpload=!!window.FormData;c.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);function d(b){var a=b==="dragover";return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var h=e.dataTransfer;if(h&&c.inArray("Files",h.types)!==-1&&this._trigger(b,c.Event(b,{delegatedEvent:e}))!==false){e.preventDefault();if(a){h.dropEffect="copy"}}}}c.widget("blueimp.fileupload",{options:{dropZone:c(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,progressInterval:100,bitrateInterval:500,autoUpload:true,uniqueFilenames:undefined,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(a,b){a=this.messages[a]||a.toString();if(b){c.each(b,function(h,g){a=a.replace("{"+h+"}",g)})}return a},formData:function(a){return a.serializeArray()},add:function(a,b){if(a.isDefaultPrevented()){return false}if(b.autoUpload||(b.autoUpload!==false&&c(this).fileupload("option","autoUpload"))){b.process().done(function(){b.submit()})}},processData:false,contentType:false,cache:false,timeout:0},_promisePipe:(function(){var a=c.fn.jquery.split(".");return Number(a[0])>1||Number(a[1])>7?"then":"pipe"})(),_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:c.support.blobSlice&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():new Date().getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(b,g,h){var a=b-this.timestamp;if(!this.bitrate||!h||a>h){this.bitrate=(g-this.loaded)*(1000/a)*8;this.loaded=g;this.timestamp=b}return this.bitrate}},_isXHRUpload:function(a){return(!a.forceIframeTransport&&((!a.multipart&&c.support.xhrFileUpload)||c.support.xhrFormDataFileUpload))},_getFormData:function(b){var a;if(c.type(b.formData)==="function"){return b.formData(b.form)}if(c.isArray(b.formData)){return b.formData}if(c.type(b.formData)==="object"){a=[];c.each(b.formData,function(h,g){a.push({name:h,value:g})});return a}return[]},_getTotal:function(a){var b=0;c.each(a,function(h,g){b+=g.size||1});return b},_initProgressObject:function(a){var b={loaded:0,total:0,bitrate:0};if(a._progress){c.extend(a._progress,b)}else{a._progress=b}},_initResponseObject:function(b){var a;if(b._response){for(a in b._response){if(Object.prototype.hasOwnProperty.call(b._response,a)){delete b._response[a]}}}else{b._response={}}},_onProgress:function(a,b){if(a.lengthComputable){var e=Date.now?Date.now():new Date().getTime(),h;if(b._time&&b.progressInterval&&e-b._time<b.progressInterval&&a.loaded!==a.total){return}b._time=e;h=Math.floor((a.loaded/a.total)*(b.chunkSize||b._progress.total))+(b.uploadedBytes||0);this._progress.loaded+=h-b._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(e,this._progress.loaded,b.bitrateInterval);b._progress.loaded=b.loaded=h;b._progress.bitrate=b.bitrate=b._bitrateTimer.getBitrate(e,h,b.bitrateInterval);this._trigger("progress",c.Event("progress",{delegatedEvent:a}),b);this._trigger("progressall",c.Event("progressall",{delegatedEvent:a}),this._progress)}},_initProgressListener:function(f){var b=this,a=f.xhr?f.xhr():c.ajaxSettings.xhr();if(a.upload){c(a.upload).on("progress",function(h){var e=h.originalEvent;h.lengthComputable=e.lengthComputable;h.loaded=e.loaded;h.total=e.total;b._onProgress(h,f)});f.xhr=function(){return a}}},_deinitProgressListener:function(b){var a=b.xhr?b.xhr():c.ajaxSettings.xhr();if(a.upload){c(a.upload).off("progress")}},_isInstanceOf:function(b,a){return Object.prototype.toString.call(a)==="[object "+b+"]"},_getUniqueFilename:function(b,a){b=String(b);if(a[b]){b=b.replace(/(?: \(([\d]+)\))?(\.[^.]+)?$/,function(m,j,k){var n=j?Number(j)+1:1;var l=k||"";return" ("+n+")"+l});return this._getUniqueFilename(b,a)}a[b]=true;return b},_initXHRData:function(k){var i=this,a,j=k.files[0],l=k.multipart||!c.support.xhrFileUpload,b=c.type(k.paramName)==="array"?k.paramName[0]:k.paramName;k.headers=c.extend({},k.headers);if(k.contentRange){k.headers["Content-Range"]=k.contentRange}if(!l||k.blob||!this._isInstanceOf("File",j)){k.headers["Content-Disposition"]='attachment; filename="'+encodeURI(j.uploadName||j.name)+'"'}if(!l){k.contentType=j.type||"application/octet-stream";k.data=k.blob||j}else{if(c.support.xhrFormDataFileUpload){if(k.postMessage){a=this._getFormData(k);if(k.blob){a.push({name:b,value:k.blob})}else{c.each(k.files,function(f,e){a.push({name:(c.type(k.paramName)==="array"&&k.paramName[f])||b,value:e})})}}else{if(i._isInstanceOf("FormData",k.formData)){a=k.formData}else{a=new FormData();c.each(this._getFormData(k),function(f,e){a.append(e.name,e.value)})}if(k.blob){a.append(b,k.blob,j.uploadName||j.name)}else{c.each(k.files,function(g,f){if(i._isInstanceOf("File",f)||i._isInstanceOf("Blob",f)){var e=f.uploadName||f.name;if(k.uniqueFilenames){e=i._getUniqueFilename(e,k.uniqueFilenames)}a.append((c.type(k.paramName)==="array"&&k.paramName[g])||b,f,e)}})}}k.data=a}}k.blob=null},_initIframeSettings:function(b){var a=c("<a></a>").prop("href",b.url).prop("host");b.dataType="iframe "+(b.dataType||"");b.formData=this._getFormData(b);if(b.redirect&&a&&a!==location.host){b.formData.push({name:b.redirectParamName||"redirect",value:b.redirect})}},_initDataSettings:function(a){if(this._isXHRUpload(a)){if(!this._chunkedUpload(a,true)){if(!a.data){this._initXHRData(a)}this._initProgressListener(a)}if(a.postMessage){a.dataType="postmessage "+(a.dataType||"")}}else{this._initIframeSettings(a)}},_getParamName:function(f){var b=c(f.fileInput),a=f.paramName;if(!a){a=[];b.each(function(){var j=c(this),i=j.prop("name")||"files[]",e=(j.prop("files")||[1]).length;while(e){a.push(i);e-=1}});if(!a.length){a=[b.prop("name")||"files[]"]}}else{if(!c.isArray(a)){a=[a]}}return a},_initFormSettings:function(a){if(!a.form||!a.form.length){a.form=c(a.fileInput.prop("form"));if(!a.form.length){a.form=c(this.options.fileInput.prop("form"))}}a.paramName=this._getParamName(a);if(!a.url){a.url=a.form.prop("action")||location.href}a.type=(a.type||(c.type(a.form.prop("method"))==="string"&&a.form.prop("method"))||"").toUpperCase();if(a.type!=="POST"&&a.type!=="PUT"&&a.type!=="PATCH"){a.type="POST"}if(!a.formAcceptCharset){a.formAcceptCharset=a.form.attr("accept-charset")}},_getAJAXSettings:function(a){var b=c.extend({},this.options,a);this._initFormSettings(b);this._initDataSettings(b);return b},_getDeferredState:function(a){if(a.state){return a.state()}if(a.isResolved()){return"resolved"}if(a.isRejected()){return"rejected"}return"pending"},_enhancePromise:function(a){a.success=a.done;a.error=a.fail;a.complete=a.always;return a},_getXHRPromise:function(b,h,i){var j=c.Deferred(),a=j.promise();h=h||this.options.context||a;if(b===true){j.resolveWith(h,i)}else{if(b===false){j.rejectWith(h,i)}}a.abort=j.promise;return this._enhancePromise(a)},_addConvenienceMethods:function(a,b){var e=this,h=function(f){return c.Deferred().resolveWith(e,f).promise()};b.process=function(f,g){if(f||g){b._processQueue=this._processQueue=(this._processQueue||h([this]))[e._promisePipe](function(){if(b.errorThrown){return c.Deferred().rejectWith(e,[b]).promise()}return h(arguments)})[e._promisePipe](f,g)}return this._processQueue||h([this])};b.submit=function(){if(this.state()!=="pending"){b.jqXHR=this.jqXHR=e._trigger("submit",c.Event("submit",{delegatedEvent:a}),this)!==false&&e._onSend(a,this)}return this.jqXHR||e._getXHRPromise()};b.abort=function(){if(this.jqXHR){return this.jqXHR.abort()}this.errorThrown="abort";e._trigger("fail",null,this);return e._getXHRPromise(false)};b.state=function(){if(this.jqXHR){return e._getDeferredState(this.jqXHR)}if(this._processQueue){return e._getDeferredState(this._processQueue)}};b.processing=function(){return(!this.jqXHR&&this._processQueue&&e._getDeferredState(this._processQueue)==="pending")};b.progress=function(){return this._progress};b.response=function(){return this._response}},_getUploadedBytes:function(b){var h=b.getResponseHeader("Range"),a=h&&h.split("-"),g=a&&a.length>1&&parseInt(a[1],10);return g&&g+1},_chunkedUpload:function(a,s){a.uploadedBytes=a.uploadedBytes||0;var t=this,v=a.files[0],u=v.size,x=a.uploadedBytes,w=a.maxChunkSize||u,q=this._blobSlice,p=c.Deferred(),b=p.promise(),r,o;if(!(this._isXHRUpload(a)&&q&&(x||(c.type(w)==="function"?w(a):w)<u))||a.data){return false}if(s){return true}if(x>=u){v.error=a.i18n("uploadedBytes");return this._getXHRPromise(false,a.context,[null,"error",v.error])}o=function(){var e=c.extend({},a),f=e._progress.loaded;e.blob=q.call(v,x,x+(c.type(w)==="function"?w(e):w),v.type);e.chunkSize=e.blob.size;e.contentRange="bytes "+x+"-"+(x+e.chunkSize-1)+"/"+u;t._trigger("chunkbeforesend",null,e);t._initXHRData(e);t._initProgressListener(e);r=((t._trigger("chunksend",null,e)!==false&&c.ajax(e))||t._getXHRPromise(false,e.context)).done(function(i,g,h){x=t._getUploadedBytes(h)||x+e.chunkSize;if(f+e.chunkSize-e._progress.loaded){t._onProgress(c.Event("progress",{lengthComputable:true,loaded:x-e.uploadedBytes,total:x-e.uploadedBytes}),e)}a.uploadedBytes=e.uploadedBytes=x;e.result=i;e.textStatus=g;e.jqXHR=h;t._trigger("chunkdone",null,e);t._trigger("chunkalways",null,e);if(x<u){o()}else{p.resolveWith(e.context,[i,g,h])}}).fail(function(i,g,h){e.jqXHR=i;e.textStatus=g;e.errorThrown=h;t._trigger("chunkfail",null,e);t._trigger("chunkalways",null,e);p.rejectWith(e.context,[i,g,h])}).always(function(){t._deinitProgressListener(e)})};this._enhancePromise(b);b.abort=function(){return r.abort()};o();return b},_beforeSend:function(a,b){if(this._active===0){this._trigger("start");this._bitrateTimer=new this._BitrateTimer();this._progress.loaded=this._progress.total=0;this._progress.bitrate=0}this._initResponseObject(b);this._initProgressObject(b);b._progress.loaded=b.loaded=b.uploadedBytes||0;b._progress.total=b.total=this._getTotal(b.files)||1;b._progress.bitrate=b.bitrate=0;this._active+=1;this._progress.loaded+=b.loaded;this._progress.total+=b.total},_onDone:function(l,a,b,j){var i=j._progress.total,k=j._response;if(j._progress.loaded<i){this._onProgress(c.Event("progress",{lengthComputable:true,loaded:i,total:i}),j)}k.result=j.result=l;k.textStatus=j.textStatus=a;k.jqXHR=j.jqXHR=b;this._trigger("done",null,j)},_onFail:function(h,a,b,i){var j=i._response;if(i.recalculateProgress){this._progress.loaded-=i._progress.loaded;this._progress.total-=i._progress.total}j.jqXHR=i.jqXHR=h;j.textStatus=i.textStatus=a;j.errorThrown=i.errorThrown=b;this._trigger("fail",null,i)},_onAlways:function(b,a,g,h){this._trigger("always",null,h)},_onSend:function(m,o){if(!o.submit){this._addConvenienceMethods(m,o)}var n=this,b,r,e,q,a=n._getAJAXSettings(o),p=function(){n._sending+=1;a._bitrateTimer=new n._BitrateTimer();b=b||(((r||n._trigger("send",c.Event("send",{delegatedEvent:m}),a)===false)&&n._getXHRPromise(false,a.context,r))||n._chunkedUpload(a)||c.ajax(a)).done(function(g,h,f){n._onDone(g,h,f,a)}).fail(function(g,h,f){n._onFail(g,h,f,a)}).always(function(i,h,f){n._deinitProgressListener(a);n._onAlways(i,h,f,a);n._sending-=1;n._active-=1;if(a.limitConcurrentUploads&&a.limitConcurrentUploads>n._sending){var g=n._slots.shift();while(g){if(n._getDeferredState(g)==="pending"){g.resolve();break}g=n._slots.shift()}}if(n._active===0){n._trigger("stop")}});return b};this._beforeSend(m,a);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){e=c.Deferred();this._slots.push(e);q=e[n._promisePipe](p)}else{this._sequence=this._sequence[n._promisePipe](p,p);q=this._sequence}q.abort=function(){r=[undefined,"abort","abort"];if(!b){if(e){e.rejectWith(a.context,r)}return p()}return b.abort()};return this._enhancePromise(q)}return p()},_onAdd:function(b,w){var e=this,E=true,F=c.extend({},this.options,w),B=w.files,H=B.length,A=F.limitMultiFileUploads,y=F.limitMultiFileUploadSize,G=F.limitMultiFileUploadSizeOverhead,i=0,j=this._getParamName(F),C,D,a,x,z=0;if(!H){return false}if(y&&B[0].size===undefined){y=undefined}if(!(F.singleFileUploads||A||y)||!this._isXHRUpload(F)){a=[B];C=[j]}else{if(!(F.singleFileUploads||y)&&A){a=[];C=[];for(x=0;x<H;x+=A){a.push(B.slice(x,x+A));D=j.slice(x,x+A);if(!D.length){D=j}C.push(D)}}else{if(!F.singleFileUploads&&y){a=[];C=[];for(x=0;x<H;x=x+1){i+=B[x].size+G;if(x+1===H||i+B[x+1].size+G>y||(A&&x+1-z>=A)){a.push(B.slice(z,x+1));D=j.slice(z,x+1);if(!D.length){D=j}C.push(D);z=x+1;i=0}}}else{C=j}}}w.originalFiles=B;c.each(a||B,function(h,g){var f=c.extend({},w);f.files=a?g:[g];f.paramName=C[h];e._initResponseObject(f);e._initProgressObject(f);e._addConvenienceMethods(b,f);E=e._trigger("add",c.Event("add",{delegatedEvent:b}),f);return E});return E},_replaceFileInput:function(a){var h=a.fileInput,g=h.clone(true),b=h.is(document.activeElement);a.fileInputClone=g;c("<form></form>").append(g)[0].reset();h.after(g).detach();if(b){g.trigger("focus")}c.cleanData(h.off("remove"));this.options.fileInput=this.options.fileInput.map(function(f,e){if(e===h[0]){return g[0]}return e});if(h[0]===this.element[0]){this.element=g}},_handleFileTreeEntry:function(m,b){var p=this,l=c.Deferred(),r=[],a,q=function(e){if(e&&!e.entry){e.entry=m}l.resolve([e])},n=function(e){p._handleFileTreeEntries(e,b+m.name+"/").done(function(f){l.resolve(f)}).fail(q)},o=function(){a.readEntries(function(e){if(!e.length){n(r)}else{r=r.concat(e);o()}},q)};b=b||"";if(m.isFile){if(m._file){m._file.relativePath=b;l.resolve(m._file)}else{m.file(function(e){e.relativePath=b;l.resolve(e)},q)}}else{if(m.isDirectory){a=m.createReader();o()}else{l.resolve([])}}return l.promise()},_handleFileTreeEntries:function(f,a){var b=this;return c.when.apply(c,c.map(f,function(e){return b._handleFileTreeEntry(e,a)}))[this._promisePipe](function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(a){a=a||{};var b=a.items;if(b&&b.length&&(b[0].webkitGetAsEntry||b[0].getAsEntry)){return this._handleFileTreeEntries(c.map(b,function(g){var h;if(g.webkitGetAsEntry){h=g.webkitGetAsEntry();if(h){h._file=g.getAsFile()}return h}return g.getAsEntry()}))}return c.Deferred().resolve(c.makeArray(a.files)).promise()},_getSingleFileInputFiles:function(b){b=c(b);var h=b.prop("webkitEntries")||b.prop("entries"),g,a;if(h&&h.length){return this._handleFileTreeEntries(h)}g=c.makeArray(b.prop("files"));if(!g.length){a=b.prop("value");if(!a){return c.Deferred().resolve([]).promise()}g=[{name:a.replace(/^.*\\/,"")}]}else{if(g[0].name===undefined&&g[0].fileName){c.each(g,function(f,e){e.name=e.fileName;e.size=e.fileSize})}}return c.Deferred().resolve(g).promise()},_getFileInputFiles:function(a){if(!(a instanceof c)||a.length===1){return this._getSingleFileInputFiles(a)}return c.when.apply(c,c.map(a,this._getSingleFileInputFiles))[this._promisePipe](function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(a){var e=this,b={fileInput:c(a.target),form:c(a.target.form)};this._getFileInputFiles(b.fileInput).always(function(f){b.files=f;if(e.options.replaceFileInput){e._replaceFileInput(b)}if(e._trigger("change",c.Event("change",{delegatedEvent:a}),b)!==false){e._onAdd(a,b)}})},_onPaste:function(a){var e=a.originalEvent&&a.originalEvent.clipboardData&&a.originalEvent.clipboardData.items,b={files:[]};if(e&&e.length){c.each(e,function(j,f){var i=f.getAsFile&&f.getAsFile();if(i){b.files.push(i)}});if(this._trigger("paste",c.Event("paste",{delegatedEvent:a}),b)!==false){this._onAdd(a,b)}}},_onDrop:function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var h=this,b=a.dataTransfer,e={};if(b&&b.files&&b.files.length){a.preventDefault();this._getDroppedFiles(b).always(function(f){e.files=f;if(h._trigger("drop",c.Event("drop",{delegatedEvent:a}),e)!==false){h._onAdd(a,e)}})}},_onDragOver:d("dragover"),_onDragEnter:d("dragenter"),_onDragLeave:d("dragleave"),_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave});this._on(this.options.pasteZone,{paste:this._onPaste})}if(c.support.fileInput){this._on(this.options.fileInput,{change:this._onChange})}},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(f,b){var a=c.inArray(f,this._specialOptions)!==-1;if(a){this._destroyEventHandlers()}this._super(f,b);if(a){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var a=this.options;if(a.fileInput===undefined){a.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]')}else{if(!(a.fileInput instanceof c)){a.fileInput=c(a.fileInput)}}if(!(a.dropZone instanceof c)){a.dropZone=c(a.dropZone)}if(!(a.pasteZone instanceof c)){a.pasteZone=c(a.pasteZone)}},_getRegExp:function(a){var b=a.split("/"),f=b.pop();b.shift();return new RegExp(b.join("/"),f)},_isRegExpOption:function(b,a){return(b!=="url"&&c.type(a)==="string"&&/^\/.*\/[igm]{0,3}$/.test(a))},_initDataAttributes:function(){var b=this,f=this.options,a=this.element.data();c.each(this.element[0].attributes,function(k,l){var j=l.name.toLowerCase(),e;if(/^data-/.test(j)){j=j.slice(5).replace(/-[a-z]/g,function(g){return g.charAt(1).toUpperCase()});e=a[j];if(b._isRegExpOption(j,e)){e=b._getRegExp(e)}f[j]=e}})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(a){var b=this;if(!a||this.options.disabled){return}if(a.fileInput&&!a.files){this._getFileInputFiles(a.fileInput).always(function(f){a.files=f;b._onAdd(null,a)})}else{a.files=c.makeArray(a.files);this._onAdd(null,a)}},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var j=this,l=c.Deferred(),a=l.promise(),k,i;a.abort=function(){i=true;if(k){return k.abort()}l.reject(null,"abort","abort");return a};this._getFileInputFiles(b.fileInput).always(function(e){if(i){return}if(!e.length){l.reject();return}b.files=e;k=j._onSend(null,b);k.then(function(h,f,g){l.resolve(h,f,g)},function(h,f,g){l.reject(h,f,g)})});return this._enhancePromise(a)}b.files=c.makeArray(b.files);if(b.files.length){return this._onSend(null,b)}}return this._getXHRPromise(false,b&&b.context)}})});